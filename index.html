<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ãªãŸã®å¥½ãã¨ä¸–ç•Œã®æ¬²ã—ã„ã‚’çµã³ã¤ã‘ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ ä½“é¨“ç‰ˆ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #FAF7F0;
            --ink: #2C2416;
            --ink-light: #5C5346;
            --accent-warm: #D97642;
            --accent-sage: #7A9B76;
            --accent-gold: #C9A961;
            --border: #E5DFD3;
            --shadow: rgba(44, 36, 22, 0.08);
            
            --font-serif: 'Crimson Pro', 'Noto Serif JP', serif;
            --font-sans: 'DM Sans', 'Noto Sans JP', sans-serif;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--cream);
            color: var(--ink);
            font-family: var(--font-serif);
            line-height: 1.7;
            overflow-x: hidden;
        }
        
        /* Landing Page */
        .landing {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: 
                radial-gradient(circle at 20% 80%, rgba(217, 118, 66, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(122, 155, 118, 0.03) 0%, transparent 50%),
                var(--cream);
        }
        
        .landing-content {
            max-width: 680px;
            text-align: center;
            opacity: 0;
            animation: fadeInUp 1s ease-out forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .logo {
            font-family: var(--font-sans);
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--ink-light);
            margin-bottom: 2rem;
            font-weight: 500;
        }
        
        h1 {
            font-family: var(--font-sans);
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1.5rem;
            color: var(--ink);
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            font-size: 1.25rem;
            color: var(--ink-light);
            margin-bottom: 3rem;
            font-style: italic;
        }
        
        .time-info {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            color: var(--ink-light);
        }
        
        .time-icon {
            width: 20px;
            height: 20px;
            color: var(--accent-warm);
        }
        
        .cta-button {
            background: var(--ink);
            color: var(--cream);
            border: none;
            padding: 1.25rem 3rem;
            font-size: 1.1rem;
            font-family: var(--font-sans);
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px var(--shadow);
            letter-spacing: 0.02em;
        }
        
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow);
            background: #3C3426;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 4rem;
            text-align: left;
        }
        
        .feature {
            opacity: 0;
            animation: fadeInUp 0.8s ease-out forwards;
        }
        
        .feature:nth-child(1) { animation-delay: 0.2s; }
        .feature:nth-child(2) { animation-delay: 0.3s; }
        .feature:nth-child(3) { animation-delay: 0.4s; }
        
        .feature-icon {
            width: 36px;
            height: 36px;
            color: var(--accent-warm);
            margin-bottom: 0.75rem;
        }
        
        .feature h3 {
            font-family: var(--font-sans);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--ink);
        }
        
        .feature p {
            font-size: 0.9rem;
            color: var(--ink-light);
            line-height: 1.6;
        }
        
        /* Main App Container */
        .app {
            display: none;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .app.active {
            display: block;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Progress Bar */
        .progress-bar {
            background: white;
            border: 1px solid var(--border);
            border-radius: 50px;
            height: 8px;
            margin-bottom: 3rem;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-warm), var(--accent-gold));
            border-radius: 50px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Day Header */
        .day-header {
            text-align: center;
            margin-bottom: 3rem;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out forwards;
        }
        
        .day-number {
            font-family: var(--font-sans);
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--accent-warm);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        
        .day-title {
            font-family: var(--font-sans);
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--ink);
            letter-spacing: -0.01em;
        }
        
        .day-description {
            font-size: 1.1rem;
            color: var(--ink-light);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.8;
            text-align: left;
        }
        
        /* Section */
        .section {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px var(--shadow);
            opacity: 0;
            animation: fadeInUp 0.8s ease-out forwards;
        }
        
        .section-title {
            font-family: var(--font-sans);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--ink);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--accent-warm);
            color: white;
            border-radius: 50%;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .section-description {
            color: var(--ink-light);
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }
        
        /* Input Areas */
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-label {
            font-family: var(--font-sans);
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--ink);
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .text-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: var(--font-serif);
            font-size: 1rem;
            color: var(--ink);
            background: var(--cream);
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 80px;
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--accent-warm);
            background: white;
            box-shadow: 0 0 0 3px rgba(217, 118, 66, 0.1);
        }
        
        .text-input::placeholder {
            color: #B5ADA0;
            font-style: italic;
        }
        
        /* List Inputs */
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .list-item {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            opacity: 0;
            animation: slideIn 0.4s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .list-number {
            font-family: var(--font-sans);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-warm);
            min-width: 24px;
            padding-top: 1rem;
        }
        
        .list-item input {
            flex: 1;
        }
        
        .add-button {
            background: transparent;
            color: var(--accent-warm);
            border: 2px dashed var(--accent-warm);
            padding: 0.75rem 1.5rem;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .add-button:hover {
            background: rgba(217, 118, 66, 0.05);
            border-color: var(--accent-warm);
        }
        
        /* Keywords */
        .keywords-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .keyword-tag {
            background: white;
            border: 2px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            color: var(--ink);
            cursor: pointer;
            transition: all 0.3s ease;
            animation: popIn 0.3s ease-out;
            position: relative;
        }
        
        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .keyword-tag:hover {
            border-color: #E74C3C;
            background: rgba(231, 76, 60, 0.05);
            transform: scale(1.05);
        }
        
        .keyword-tag:hover::after {
            content: "Ã—";
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: #E74C3C;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .keyword-tag.selected {
            background: var(--accent-warm);
            border-color: var(--accent-warm);
            color: white;
        }
        
        /* Groups */
        .groups-container {
            display: grid;
            gap: 1rem;
        }
        
        .group {
            background: var(--cream);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .group:hover {
            border-color: var(--accent-sage);
        }
        
        .group-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .group-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .group-name-input {
            flex: 1;
            border: none;
            background: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-family: var(--font-sans);
            font-weight: 600;
            font-size: 1rem;
            color: var(--ink);
        }
        
        .group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .group-item {
            background: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--ink-light);
            border: 1px solid var(--border);
        }
        
        /* Navigation */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }
        
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-family: var(--font-sans);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary {
            background: white;
            color: var(--ink);
            border: 2px solid var(--border);
        }
        
        .btn-secondary:hover {
            border-color: var(--ink-light);
            background: var(--cream);
        }
        
        .btn-primary {
            background: var(--ink);
            color: var(--cream);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
            background: #3C3426;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Completion Screen */
        .completion {
            text-align: center;
            padding: 4rem 2rem;
        }
        
        .completion-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            color: var(--accent-gold);
            opacity: 0;
            animation: scaleIn 0.6s ease-out 0.2s forwards;
        }
        
        @keyframes scaleIn {
            0% {
                opacity: 0;
                transform: scale(0.5) rotate(-10deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }
        
        .your-question {
            background: linear-gradient(135deg, 
                rgba(217, 118, 66, 0.05) 0%, 
                rgba(122, 155, 118, 0.05) 100%);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 3rem 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 24px var(--shadow);
        }
        
        .question-label {
            font-family: var(--font-sans);
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--accent-warm);
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .question-text {
            font-size: clamp(1.5rem, 3vw, 2.25rem);
            font-weight: 600;
            color: var(--ink);
            line-height: 1.4;
            margin-bottom: 1.5rem;
            font-family: var(--font-sans);
        }
        
        .question-confidence {
            font-size: 1rem;
            color: var(--ink-light);
            font-style: italic;
        }
        
        .completion-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 400px;
            margin: 2rem auto 0;
        }
        
        /* Hide/Show utilities */
        .hidden {
            display: none !important;
        }
        
        /* 2-column layout for Day 2 */
        .two-column-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        /* Reference Panel */
        .reference-panel {
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
        }
        
        .reference-header {
            background: var(--accent-warm);
            color: white;
            padding: 1rem 1.25rem;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: var(--font-sans);
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .reference-header:hover {
            background: #E66835;
        }
        
        #referenceToggleIcon {
            transition: transform 0.3s ease;
            font-size: 0.9rem;
        }
        
        #referenceToggleIcon.collapsed {
            transform: rotate(-90deg);
        }
        
        .reference-content {
            background: white;
            border: 2px solid var(--accent-warm);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: calc(100vh - 10rem);
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        .reference-content.collapsed {
            max-height: 0;
            border: none;
            overflow: hidden;
        }
        
        .reference-list {
            padding: 1.25rem;
        }
        
        .reference-item {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .reference-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .reference-number {
            font-family: var(--font-sans);
            font-weight: 700;
            color: var(--accent-warm);
            min-width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(217, 118, 66, 0.1);
            border-radius: 50%;
            flex-shrink: 0;
            font-size: 0.85rem;
        }
        
        .reference-text {
            flex: 1;
            color: var(--ink);
        }
        
        .work-area {
            min-width: 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .landing {
                padding: 1.5rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .section {
                padding: 1.5rem;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            /* Stack layout on mobile */
            .two-column-layout {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .reference-panel {
                position: static;
                max-height: none;
            }
            
            .reference-content {
                max-height: 400px;
            }
        }
        
        /* Auto-save indicator */
        .autosave-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            border: 1px solid var(--border);
            padding: 0.75rem 1.25rem;
            border-radius: 50px;
            font-family: var(--font-sans);
            font-size: 0.85rem;
            color: var(--ink-light);
            box-shadow: 0 4px 12px var(--shadow);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .autosave-indicator.show {
            opacity: 1;
        }
        
        .autosave-indicator .pulse {
            width: 8px;
            height: 8px;
            background: var(--accent-sage);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Custom Modal */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 36, 22, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .custom-modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--cream);
            border-radius: 16px;
            padding: 2rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(44, 36, 22, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-title {
            font-family: var(--font-sans);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--ink);
            margin-bottom: 1rem;
        }
        
        .modal-message {
            color: var(--ink-light);
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        
        .modal-buttons {
            display: flex;
            gap: 0.75rem;
        }
        
        .modal-buttons .btn {
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landing" class="landing">
        <div class="landing-content">
            <div class="logo">Why Me? Workbook</div>
            <h1>ã‚ãªãŸã®å¥½ãã¨<br>ä¸–ç•Œã®æ¬²ã—ã„ã‚’<br>çµã³ã¤ã‘ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯<br><span style="font-size: 0.6em; font-weight: 500; color: var(--ink-light);">ä½“é¨“ç‰ˆ</span></h1>
            <p class="subtitle">ã¼ã‚“ã‚„ã‚Šã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€è‡ªåˆ†ã ã‘ã®äº‹æ¥­ã«å¤‰ãˆã‚‹</p>
            
            <div class="time-info">
                <svg class="time-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                60ã€œ90åˆ†ã§å®Œäº†ï¼ˆé€”ä¸­ä¿å­˜å¯èƒ½ï¼‰
            </div>
            
            <button class="cta-button" onclick="startWorkbook()">
                ã•ã‚ã€å§‹ã‚ã¾ã—ã‚‡ã†
            </button>
            
            <div class="features">
                <div class="feature">
                    <svg class="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <h3>è‡ªåˆ†ã®æºæ³‰ã‚’ç™ºè¦‹</h3>
                    <p>äººç”Ÿã®ç—•è·¡ã‹ã‚‰ã€ã‚ãªãŸã ã‘ã®ã€Œå•ã„ã€ã‚’è¦‹ã¤ã‘ã¾ã™</p>
                </div>
                <div class="feature">
                    <svg class="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <h3>é€”ä¸­ä¿å­˜OK</h3>
                    <p>ä¼‘æ†©ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã€‚ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã¾ã™</p>
                </div>
                <div class="feature">
                    <svg class="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <h3>6ã‚¹ãƒ†ãƒƒãƒ—ã§å®Œçµ</h3>
                    <p>æœ¬ç·¨ã®æ ¸å¿ƒéƒ¨åˆ†ã‚’6ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ä½“é¨“ã§ãã¾ã™</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app">
        <div class="container">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- STEP 1 -->
            <div id="step1" class="day hidden">
                <div class="day-header">
                    <div class="day-number">STEP 1 of 6</div>
                    <h2 class="day-title">äººç”Ÿã®ç—•è·¡ã‚’é›†ã‚ã‚‹</h2>
                    <p class="day-description">
                        ã¾ãšã€ã‚ãªãŸè‡ªèº«ã‚’è¦‹ã¤ã‚ã¾ã™ã€‚ãƒ“ã‚¸ãƒã‚¹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è€ƒãˆã‚‹ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ãªãŸã®ä¸­ã«ã‚ã‚‹ã€Œæºæ³‰ã€ã‚’æ¢ã‚Šã¾ã™ã€‚
                    </p>
                </div>

                <!-- Work 1: é•å’Œæ„Ÿ -->
                <div class="section">
                    <h3 class="section-title">
                        <span class="section-number">1</span>
                        é•å’Œæ„Ÿã‚’æ›¸ãå‡ºã™
                    </h3>
                    <p class="section-description">
                        ã‚ãªãŸã®äººç”Ÿã§æ„Ÿã˜ã¦ããŸã€Œé•å’Œæ„Ÿã€ã‚’æ›¸ãå‡ºã—ã¦ãã ã•ã„ã€‚ã€Œãªã‚“ã‹ãŠã‹ã—ã„ãªã€ã¨æ„Ÿã˜ãŸã“ã¨ã€å‘¨ã‚Šã¯æ°—ã«ã—ã¦ã„ãªã„ã®ã«è‡ªåˆ†ã ã‘æ°—ã«ãªã£ãŸã“ã¨ãªã©ã€æ€ã„ã¤ãã¾ã¾ã«ã€‚
                    </p>
                    <div class="list-container" id="iwakanList"></div>
                    <button class="add-button" onclick="addIwakan()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        é•å’Œæ„Ÿã‚’è¿½åŠ 
                    </button>
                </div>

                <!-- Work 2: å–œã³ -->
                <div class="section">
                    <h3 class="section-title">
                        <span class="section-number">2</span>
                        å–œã³ã®æºæ³‰ã‚’æ›¸ãå‡ºã™
                    </h3>
                    <p class="section-description">
                        ã‚ãªãŸãŒã€Œå–œã³ã€ã‚’æ„Ÿã˜ãŸç¬é–“ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚æ™‚é–“ã‚’å¿˜ã‚Œã¦æ²¡é ­ã—ãŸã“ã¨ã€ã€Œã“ã‚Œã€æ¥½ã—ã„ï¼ã€ã¨å¿ƒãŒå‹•ã„ãŸã“ã¨ãªã©ã€‚
                    </p>
                    <div class="list-container" id="yorokobiList"></div>
                    <button class="add-button" onclick="addYorokobi()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        å–œã³ã‚’è¿½åŠ 
                    </button>
                </div>

                <!-- Work 3: æ€’ã‚Š -->
                <div class="section">
                    <h3 class="section-title">
                        <span class="section-number">3</span>
                        æ€’ã‚Šã®æºæ³‰ã‚’æ›¸ãå‡ºã™
                    </h3>
                    <p class="section-description">
                        ã‚ãªãŸãŒã€Œæ€’ã‚Šã€ã‚„ã€Œæ‚²ã—ã¿ã€ã‚’æ„Ÿã˜ãŸã“ã¨ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚ã€Œã“ã‚Œã¯è¨±ã›ãªã„ã€ã¨æ€ã£ãŸã“ã¨ã€ç†ä¸å°½ã ã¨æ„Ÿã˜ãŸã“ã¨ã€ã€Œå¤‰ãˆãŸã„ã€ã¨æ€ã£ãŸç¾å®Ÿãªã©ã€‚
                    </p>
                    <div class="list-container" id="ikariList"></div>
                    <button class="add-button" onclick="addIkari()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        æ€’ã‚Šã‚’è¿½åŠ 
                    </button>
                </div>

                <div class="nav-buttons" style="justify-content: flex-end;">
                    <button class="btn btn-primary" onclick="goToStep(2)" id="step1Next">
                        STEP 2ã¸é€²ã‚€
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- STEP 2: Keywords Extraction -->
            <div id="step2" class="day hidden">
                <div class="day-header">
                    <div class="day-number">STEP 2 of 6</div>
                    <h2 class="day-title">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹</h2>
                    <p class="day-description">
                        STEP 1ã§æ›¸ã„ãŸå†…å®¹ã‹ã‚‰ã€ç¹°ã‚Šè¿”ã—å‡ºã¦ãã‚‹ã€Œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã‚’æŠ½å‡ºã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã®è»¸ã«ãªã‚Šã¾ã™ã€‚<br>
                        æ­£è§£ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã‚ãªãŸã®ä¾¡å€¤è¦³ã‚’è¨€èªåŒ–ã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚è‡ªç”±ã«è¨€è‘‰ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚
                    </p>
                </div>

                <!-- 2-column layout container -->
                <div class="two-column-layout">
                    <!-- Left: STEP 1 Reference Panel -->
                    <div class="reference-panel">
                        <div class="reference-header" onclick="toggleReference()">
                            <span id="referenceToggleIcon">â–¼</span>
                            <span>STEP 1ã®å†…å®¹ã‚’è¦‹ã‚‹</span>
                        </div>
                        <div class="reference-content" id="step1Reference">
                            <div class="reference-list" id="step1ReferenceList"></div>
                        </div>
                    </div>

                    <!-- Right: Work Area -->
                    <div class="work-area">
                        <!-- Work 1: Keywords -->
                        <div class="section">
                            <h3 class="section-title">
                                <span class="section-number">1</span>
                                ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã¦ã‚¿ã‚°åŒ–
                            </h3>
                            <p class="section-description">
                                STEP 1ã§æ›¸ã„ãŸå†…å®¹ã‹ã‚‰ã€ç¹°ã‚Šè¿”ã—å‡ºã¦ãã‚‹ã€Œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã‚’æŠ½å‡ºã—ã€ã‚¿ã‚°åŒ–ã—ã¾ã—ã‚‡ã†ã€‚ä½•åº¦ã‚‚å‡ºã¦ãã‚‹è¨€è‘‰ã€ã‚ãªãŸãŒå¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³ã‚’è¡¨ã™è¨€è‘‰ãªã©ã€‚3ã€œ5å€‹ã‚’ç›®å®‰ã«æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
                            </p>
                            <div class="input-group">
                                <input type="text" 
                                       class="text-input" 
                                       id="keywordInput" 
                                       placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šè‡ªç”±ã€æœ¬éŸ³ã€ã¤ãªãŒã‚Šã€è¡¨ç¾...ï¼‰"
                                       style="min-height: 50px;"
                                       onkeypress="handleKeywordEnter(event)">
                                <button type="button" class="btn btn-primary" onclick="addKeywordFromButton()" style="margin-top: 0.75rem; width: auto; padding: 0.75rem 1.5rem;">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    ã‚¿ã‚°ã¨ã—ã¦è¿½åŠ 
                                </button>
                                <p style="font-size: 0.85rem; color: var(--ink-light); font-style: italic; margin-top: 0.5rem;">
                                    ğŸ’¡ Enterã‚­ãƒ¼ã¾ãŸã¯ãƒœã‚¿ãƒ³ã§ã‚¿ã‚°åŒ–ã•ã‚Œã¾ã™
                                </p>
                            </div>
                            <div class="keywords-container" id="keywordsContainer"></div>
                            <p style="font-size: 0.85rem; color: var(--ink-light); font-style: italic; margin-top: 0.5rem; text-align: center;" id="keywordHint"></p>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(1)">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        STEP 1ã¸æˆ»ã‚‹
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(3)">
                        STEP 3ã¸é€²ã‚€
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- STEP 3: Grouping -->
            <div id="step3" class="day hidden">
                <div class="day-header">
                    <div class="day-number">STEP 3 of 6</div>
                    <h2 class="day-title">ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°</h2>
                    <p class="day-description">
                        ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã—ã¾ã™ã€‚1ã¤ã®ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒè¤‡æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«å…¥ã£ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚
                    </p>
                </div>

                <!-- 2-column layout container -->
                <div class="two-column-layout">
                    <!-- Left: Episode Reference Panel -->
                    <div class="reference-panel">
                        <div class="reference-header" onclick="toggleReferenceStep3()">
                            <span id="referenceToggleIconStep3">â–¼</span>
                            <span>STEP 1ã®ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä¸€è¦§</span>
                        </div>
                        <div class="reference-content" id="step3Reference">
                            <div class="reference-list" id="step3ReferenceList"></div>
                        </div>
                    </div>

                    <!-- Right: Work Area -->
                    <div class="work-area">
                        <div class="section">
                            <h3 class="section-title">
                                <span class="section-number">1</span>
                                ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—
                            </h3>
                            <p class="section-description">
                                STEP 2ã§æŠ½å‡ºã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—ãŒä½œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚å„ã‚°ãƒ«ãƒ¼ãƒ—ã«å½“ã¦ã¯ã¾ã‚‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã®ç•ªå·ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆä¾‹ï¼š1, 3, 5ï¼‰
                            </p>
                            <div id="keywordGroupsContainer"></div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(2)">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        STEP 2ã¸æˆ»ã‚‹
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(4)">
                        STEP 4ã¸é€²ã‚€
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- STEP 4: Theme Discovery -->
            <div id="step4" class="day hidden">
                <div class="day-header">
                    <div class="day-number">STEP 4 of 6</div>
                    <h2 class="day-title">ãƒ†ãƒ¼ãƒã‚’ç™ºè¦‹ã™ã‚‹</h2>
                    <p class="day-description">
                        ã‚°ãƒ«ãƒ¼ãƒ—ã‚’çœºã‚ãªãŒã‚‰ã€æ·±å±¤ã«ã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™ºè¦‹ã—ã¦ã„ãã¾ã™ã€‚
                    </p>
                </div>

                <!-- 2-column layout container -->
                <div class="two-column-layout">
                    <!-- Left: Groups Reference Panel -->
                    <div class="reference-panel">
                        <div class="reference-header" onclick="toggleReferenceStep4()">
                            <span id="referenceToggleIconStep4">â–¼</span>
                            <span>STEP 3ã®ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§</span>
                        </div>
                        <div class="reference-content" id="step4Reference">
                            <div class="reference-list" id="step4ReferenceList"></div>
                        </div>
                    </div>

                    <!-- Right: Work Area -->
                    <div class="work-area">
                        <div class="section">
                            <h3 class="section-title">
                                <span class="section-number">1</span>
                                æ·±å±¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™ºè¦‹ã™ã‚‹
                            </h3>
                            <p class="section-description">
                                ã‚°ãƒ«ãƒ¼ãƒ—ã‚’çœºã‚ãªãŒã‚‰ã€ä»¥ä¸‹ã®å•ã„ã«ç­”ãˆã¦ãã ã•ã„ã€‚
                            </p>
                            <div class="input-group">
                                <label class="input-label">ç¹°ã‚Šè¿”ã—å‡ºã¦ãã‚‹ãƒ†ãƒ¼ãƒã¯ï¼Ÿ</label>
                                <textarea class="text-input" id="theme" placeholder="è¤‡æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«å…±é€šã™ã‚‹ãƒ†ãƒ¼ãƒãŒã‚ã‚Œã°..."></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label">ã‚ãªãŸãŒå¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³ã¯ï¼Ÿ</label>
                                <textarea class="text-input" id="values" placeholder="ã“ã‚Œã‚‰ã®çµŒé¨“ã‹ã‚‰è¦‹ãˆã‚‹ä¾¡å€¤è¦³..."></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label">ã‚ãªãŸãŒã€Œè¨±ã›ãªã„ã€ã‚‚ã®ã¯ï¼Ÿ</label>
                                <textarea class="text-input" id="unacceptable" placeholder="é•å’Œæ„Ÿã‚„æ€’ã‚Šã®å¥¥ã«ã‚ã‚‹ã€Œã“ã‚Œã ã‘ã¯è­²ã‚Œãªã„ã€..."></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label">ã‚ãªãŸãŒã€Œã“ã†ã‚ã£ã¦ã»ã—ã„ã€ä¸–ç•Œã¯ï¼Ÿ</label>
                                <textarea class="text-input" id="idealWorld" placeholder="ã‚‚ã—é•å’Œæ„ŸãŒè§£æ¶ˆã•ã‚ŒãŸã‚‰..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(3)">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        STEP 3ã¸æˆ»ã‚‹
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(5)">
                        STEP 5ã¸é€²ã‚€
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- STEP 5: Why Digging -->
            <div id="step5" class="day hidden">
                <div class="day-header">
                    <div class="day-number">STEP 5 of 6</div>
                    <h2 class="day-title">ãªãœã‚’æ˜ã‚Šä¸‹ã’ã‚‹</h2>
                    <p class="day-description">
                        STEP 4ã§è¦‹ã¤ã‘ãŸãƒ†ãƒ¼ãƒã‚’ã€Œãªãœï¼Ÿã€ã§3ã€œ5å›æ˜ã‚Šä¸‹ã’ã¦ã„ãã¾ã™ã€‚
                    </p>
                </div>

                <!-- 2-column layout container -->
                <div class="two-column-layout">
                    <!-- Left: Theme Reference Panel -->
                    <div class="reference-panel">
                        <div class="reference-header" onclick="toggleReferenceStep5()">
                            <span id="referenceToggleIconStep5">â–¼</span>
                            <span>STEP 4ã®ãƒ†ãƒ¼ãƒã‚’è¦‹ã‚‹</span>
                        </div>
                        <div class="reference-content" id="step5Reference">
                            <div class="reference-list" id="step5ReferenceList"></div>
                        </div>
                    </div>

                    <!-- Right: Work Area -->
                    <div class="work-area">
                        <!-- Work 1: Question Creation -->
                        <div class="section">
                            <h3 class="section-title">
                                <span class="section-number">1</span>
                                å•ã„ã®åŸå‹ã‚’ä½œã‚‹
                            </h3>
                            <p class="section-description">
                                STEP 4ã§è¦‹ã¤ã‘ãŸå†…å®¹ã‚’è¦‹ãªãŒã‚‰ã€ãã‚Œã‚’ã€Œå•ã„ã€ã®å½¢ã«å¤‰æ›ã—ã¦ã„ãã¾ã™ã€‚<br>
                                ä»¥ä¸‹ã®ãƒ’ãƒ³ãƒˆã‚’å‚è€ƒã«ã€ã‚ãªãŸã®å•ã„ã‚’3ã€œ5å€‹ä½œã£ã¦ã¿ã¦ãã ã•ã„ã€‚
                            </p>
                            
                            <div style="background: rgba(122, 155, 118, 0.08); border-left: 3px solid var(--accent-sage); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h4 style="font-family: var(--font-sans); font-size: 1rem; font-weight: 600; color: var(--ink); margin-bottom: 1rem;">å•ã„ã¥ãã‚Šã®ãƒ’ãƒ³ãƒˆ</h4>
                                
                                <div style="margin-bottom: 1.25rem;">
                                    <div style="font-family: var(--font-sans); font-weight: 600; color: var(--accent-warm); margin-bottom: 0.5rem;">è¦–ç‚¹1ï¼šèª²é¡Œãƒ»æ©Ÿèƒ½</div>
                                    <div style="color: var(--ink-light); font-size: 0.95rem; line-height: 1.6;">
                                        ãƒ»ã€Œã€‡ã€‡ï¼ˆãƒ†ãƒ¼ãƒï¼‰ã¯ãªãœèµ·ãã‚‹ã®ã‹ï¼Ÿã€<br>
                                        ãƒ»ã€Œã€‡ã€‡ï¼ˆè¨±ã›ãªã„ã‚‚ã®ï¼‰ã‚’ãªãã™ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿã€
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 1.25rem;">
                                    <div style="font-family: var(--font-sans); font-weight: 600; color: var(--accent-warm); margin-bottom: 0.5rem;">è¦–ç‚¹2ï¼šæ„Ÿæƒ…ãƒ»ä½“é¨“</div>
                                    <div style="color: var(--ink-light); font-size: 0.95rem; line-height: 1.6;">
                                        ãƒ»ã€Œã©ã†ã™ã‚Œã°äººã¯ã€‡ã€‡ï¼ˆä¾¡å€¤è¦³ï¼‰ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹ã‹ï¼Ÿã€<br>
                                        ãƒ»ã€Œã€‡ã€‡ã‚’å¤§åˆ‡ã«ã§ãã‚‹ç’°å¢ƒã¨ã¯ï¼Ÿã€
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 0;">
                                    <div style="font-family: var(--font-sans); font-weight: 600; color: var(--accent-warm); margin-bottom: 0.5rem;">è¦–ç‚¹3ï¼šé–¢ä¿‚æ€§ãƒ»ç¤¾ä¼š</div>
                                    <div style="color: var(--ink-light); font-size: 0.95rem; line-height: 1.6;">
                                        ãƒ»ã€Œã€‡ã€‡ï¼ˆç†æƒ³ã®ä¸–ç•Œï¼‰ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ä½•ãŒå¿…è¦ã‹ï¼Ÿã€<br>
                                        ãƒ»ã€Œã€‡ã€‡ã‚’å¤§åˆ‡ã«ã™ã‚‹ç¤¾ä¼šã¯ã©ã†ä½œã‚Œã‚‹ã‹ï¼Ÿã€
                                    </div>
                                </div>
                            </div>
                            
                            <div class="list-container" id="questionsList"></div>
                            <button class="add-button" onclick="addQuestion()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                å•ã„ã‚’è¿½åŠ 
                            </button>
                            <p style="font-size: 0.85rem; color: var(--ink-light); font-style: italic; margin-top: 1rem; text-align: center;">
                                ğŸ’¡ ä¸Šã®ãƒ’ãƒ³ãƒˆã¯å‚è€ƒã§ã™ã€‚è‡ªç”±ã«å•ã„ã‚’ä½œã£ã¦ãã ã•ã„ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(4)">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        STEP 4ã¸æˆ»ã‚‹
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(6)">
                        STEP 6ã¸é€²ã‚€
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- STEP 6: Question Creation -->
            <div id="step6" class="day hidden">
                <div class="day-header">
                    <div class="day-number">STEP 6 of 6</div>
                    <h2 class="day-title">å•ã„ã®å‰µé€ </h2>
                    <p class="day-description">
                        å•ã„ã®åŸå‹ãŒã§ãã¾ã—ãŸã€‚ãã®ä¸­ã‹ã‚‰æœ€ã‚‚ã—ã£ãã‚Šãã‚‹ã‚‚ã®ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚ãã‚ŒãŒã‚ãªãŸã®è¿½æ±‚ã™ã¹ãæœ€åˆã®å•ã„ã¨ãªã‚Šã¾ã™ã€‚
                    </p>
                </div>

                <!-- 2-column layout container -->
                <div class="two-column-layout">
                    <!-- Left: Why & Questions Reference Panel -->
                    <div class="reference-panel">
                        <div class="reference-header" onclick="toggleReferenceStep6()">
                            <span id="referenceToggleIconStep6">â–¼</span>
                            <span>STEP 5ã®å†…å®¹ã‚’è¦‹ã‚‹</span>
                        </div>
                        <div class="reference-content" id="step6Reference">
                            <div class="reference-list" id="step6ReferenceList"></div>
                        </div>
                    </div>

                    <!-- Right: Work Area -->
                    <div class="work-area">
                        <!-- Work 3: Select Final Question -->
                        <div class="section">
                            <h3 class="section-title">
                                <span class="section-number">1</span>
                                æš«å®šç‰ˆã€Œè‡ªåˆ†ã®å•ã„ã€ã‚’é¸ã¶
                            </h3>
                            <p class="section-description">
                                STEP 5ã§æ›¸ã„ãŸå•ã„ã®ä¸­ã‹ã‚‰ã€ä»Šã®æ™‚ç‚¹ã§æœ€ã‚‚ã—ã£ãã‚Šãã‚‹ã‚‚ã®ã‚’1ã¤é¸ã‚“ã§ãã ã•ã„ã€‚
                            </p>
                            <div class="input-group">
                                <label class="input-label">ã‚ãªãŸã®å•ã„ï¼ˆæš«å®šç‰ˆï¼‰</label>
                                <textarea class="text-input" id="finalQuestion" placeholder="è€ƒãˆã‚‹ã ã‘ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæ¹§ã„ã¦ãã‚‹å•ã„ã‚’..."></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label">ãªãœã“ã®å•ã„ã‚’é¸ã³ã¾ã—ãŸã‹ï¼Ÿ</label>
                                <textarea class="text-input" id="whyThisQuestion" placeholder=""></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(5)">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        STEP 5ã¸æˆ»ã‚‹
                    </button>
                    <button class="btn btn-primary" onclick="completeWorkbook()">
                        å®Œäº†ã™ã‚‹
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Completion -->
            <div id="completion" class="day hidden">
                <div class="completion">
                    <svg class="completion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    
                    <h2 class="day-title">ãŠç–²ã‚Œã•ã¾ã§ã—ãŸ</h2>
                    <p class="day-description" id="completionMessage">
                        3æ—¥é–“ã®æ—…ã‚’é€šã˜ã¦ã€ã‚ãªãŸã¯ã€Œè‡ªåˆ†ã®å•ã„ã€ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚<br>
                        ã“ã®å•ã„ãŒã€ã‚ãªãŸã®äº‹æ¥­ã®åŸç‚¹ã«ãªã‚Šã¾ã™ã€‚
                    </p>

                    <div class="your-question">
                        <div class="question-label">ã‚ãªãŸã®å•ã„</div>
                        <div class="question-text" id="displayQuestion"></div>
                    </div>

                    <div class="completion-actions">
                        <button class="btn btn-primary" onclick="downloadResults()" style="width: 100%;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                            </svg>
                            PDFã§ä¿å­˜ã™ã‚‹
                        </button>
                        <p style="font-size: 0.85rem; color: var(--ink-light); text-align: center; margin-top: 0.5rem; margin-bottom: 2rem; font-style: italic;">
                            å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã¾ã™ã€‚ã€Œé€ä¿¡å…ˆã€ã§ã€ŒPDFã«ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„
                        </p>
                        
                        <div style="padding: 2rem; background: rgba(217, 118, 66, 0.05); border-radius: 12px; border: 1px solid var(--border); margin-bottom: 2rem;">
                            <h3 style="font-family: var(--font-sans); font-size: 1.1rem; margin-bottom: 1rem; color: var(--ink);">NEXT STEP</h3>
                            <p style="color: var(--ink-light); line-height: 1.8; text-align: left;">
                                ã“ã®ä½“é¨“ç‰ˆã§ã¯ã€æœ¬ç·¨ã®Phase 1ã€è‡ªåˆ†ã®æºæ³‰ã‚’æ¢ã‚‹ã€‘ã‚’ä½“é¨“ã—ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚<br><br>
                                æœ¬ç·¨ã®ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã§ã¯ã€æ¬¡ã«ã“ã®"å•ã„"ã‚’å…±æœ‰ã§ãã‚‹ä»–è€…ã®å­˜åœ¨ã‚’æƒ³åƒã—ã¾ã™ã€‚<br>
                                ã•ã‚‰ã«ãã®"å…±é€šã®å•ã„"ã‚’ã‚‚ã¨ã«ã€ä»®èª¬ã€è§£æ±ºã™ã¹ãèª²é¡Œã€‘ã‚’ã€æƒ³å®šã—ã¾ã™ã€‚<br>
                                ã€è§£æ±ºã™ã¹ãèª²é¡Œã€‘ãŒæ±ºã¾ã£ãŸã‚‰æœ¬æ ¼çš„ã«ä»–è€…ã¸ã®ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚<br><br>
                                ã“ã®ã‚ˆã†ã«"è‡ªåˆ†ã®æ„è¦‹"ã¨"ç¾å®Ÿã®ä»–è€…"ã‚’è¡Œãæ¥ã—ãªãŒã‚‰ã€1ã‹æœˆé–“ã§ã€ã‚ãªãŸã ã‘ã®äº‹æ¥­ã‚¢ã‚¤ãƒ‡ã‚¢ã€‘ã‚’ç”Ÿã¿å‡ºã™ã“ã¨ãŒã€ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã®ç›®çš„ã§ã™ã€‚
                            </p>
                        </div>
                        
                        <button class="btn btn-secondary" onclick="goToStep(6)" style="width: 100%;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            STEP 6ã¸æˆ»ã‚‹
                        </button>
                        <button class="btn btn-secondary" data-action="reset" style="width: 100%; background: white; color: var(--ink-light); border: 1px solid var(--border); margin-top: 0.5rem;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            æœ€åˆã«æˆ»ã‚‹ï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼‰
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-save Indicator -->
    <div class="autosave-indicator" id="autosaveIndicator">
        <div class="pulse"></div>
        è‡ªå‹•ä¿å­˜ã—ã¾ã—ãŸ
    </div>

    <!-- Custom Confirmation Modal -->
    <div class="custom-modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ</div>
            <div class="modal-message">
                æœ¬å½“ã«æœ€åˆã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ<br>
                å…¥åŠ›ã—ãŸã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚<br><br>
                <strong>â€»ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</strong>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" data-action="cancel-reset">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" data-action="confirm-reset" style="background: #D97642;">
                    ãƒªã‚»ãƒƒãƒˆã™ã‚‹
                </button>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let state = {
            currentStep: 0,
            iwakan: [],
            yorokobi: [],
            ikari: [],
            keywords: [],
            groups: [],
            theme: '',
            values: '',
            unacceptable: '',
            idealWorld: '',
            questions: [],
            finalQuestion: '',
            whyThisQuestion: ''
        };

        // Storage utilities
        function saveState() {
            try {
                localStorage.setItem('workbook-state', JSON.stringify(state));
                showAutosaveIndicator();
            } catch (error) {
                console.error('Save error:', error);
            }
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('workbook-state');
                if (saved) {
                    state = JSON.parse(saved);
                    return true;
                }
            } catch (error) {
                console.error('Load error:', error);
            }
            return false;
        }

        function showAutosaveIndicator() {
            const indicator = document.getElementById('autosaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Initialize
        function init() {
            const hasState = loadState();
            
            // Don't restore if on completion screen - always start fresh
            if (hasState && state.currentStep > 0 && state.currentStep < 7) {
                // Resume from saved state (STEP 1-6 only)
                document.getElementById('landing').classList.remove('landing');
                document.getElementById('landing').style.display = 'none';
                document.getElementById('app').classList.add('active');
                goToStep(state.currentStep);
            } else {
                // Initialize with first items or restart from landing
                state.iwakan = state.iwakan || [''];
                state.yorokobi = state.yorokobi || [''];
                state.ikari = state.ikari || [''];
                state.groups = state.groups || [];
                state.questions = state.questions || [''];
                state.currentStep = 0; // Reset to landing
            }
            
            // Add event listeners for reset buttons
            setupResetButtons();
        }

        function setupResetButtons() {
            // Find all reset buttons and add click listeners
            document.querySelectorAll('[data-action="reset"]').forEach(button => {
                button.addEventListener('click', confirmReset);
            });
            
            // Modal buttons
            const modalCancelBtn = document.querySelector('[data-action="cancel-reset"]');
            if (modalCancelBtn) {
                modalCancelBtn.addEventListener('click', closeModal);
            }
            
            const modalConfirmBtn = document.querySelector('[data-action="confirm-reset"]');
            if (modalConfirmBtn) {
                modalConfirmBtn.addEventListener('click', confirmResetAction);
            }
        }

        // Landing
        function startWorkbook() {
            document.getElementById('landing').style.display = 'none';
            document.getElementById('app').classList.add('active');
            goToStep(1);
        }

        function showLanding() {
            if (confirm('æœ€åˆã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿï¼ˆãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ï¼‰')) {
                document.getElementById('app').classList.remove('active');
                document.getElementById('landing').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('landing').classList.add('landing');
                }, 10);
            }
        }

        // Navigation
        function goToStep(step) {
            // Hide all steps
            document.querySelectorAll('.day').forEach(d => d.classList.add('hidden'));
            
            // Show target step
            state.currentStep = step;
            
            // Handle step display
            if (step >= 1 && step <= 6) {
                const stepElement = document.getElementById(`step${step}`);
                if (stepElement) {
                    stepElement.classList.remove('hidden');
                    window.scrollTo(0, 0);
                }
            } else if (step === 7) {
                // Completion screen
                document.getElementById('completion').classList.remove('hidden');
                window.scrollTo(0, 0);
            }
            
            // Update progress
            updateProgress();
            
            // Render content based on step
            switch(step) {
                case 1: renderStep1(); break;
                case 2: renderStep2(); break;
                case 3: renderStep3(); break;
                case 4: renderStep4(); break;
                case 5: renderStep5(); break;
                case 6: renderStep6(); break;
            }
            
            saveState();
        }

        function updateProgress() {
            const progress = (state.currentStep / 7) * 100; // 7 = 6 steps + completion
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // STEP 1: List Management
        function renderStep1() {
            renderList('iwakanList', state.iwakan, 'iwakan');
            renderList('yorokobiList', state.yorokobi, 'yorokobi');
            renderList('ikariList', state.ikari, 'ikari');
        }

        function renderList(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-number">${index + 1}</div>
                    <input type="text" 
                           class="text-input" 
                           value="${item}" 
                           placeholder="ã“ã“ã«æ›¸ã„ã¦ãã ã•ã„..."
                           oninput="updateListItem('${type}', ${index}, this.value)"
                           style="min-height: 60px;">
                `;
                container.appendChild(div);
            });
        }

        function updateListItem(type, index, value) {
            state[type][index] = value;
            saveState();
        }

        function addIwakan() {
            state.iwakan.push('');
            renderStep1();
            saveState();
        }

        function addYorokobi() {
            state.yorokobi.push('');
            renderStep1();
            saveState();
        }

        function addIkari() {
            state.ikari.push('');
            renderStep1();
            saveState();
        }

        // STEP 2: Keywords Extraction
        function renderStep2() {
            // Populate STEP 1 reference
            populateStep1Reference();
            
            // Render keywords
            const container = document.getElementById('keywordsContainer');
            container.innerHTML = '';
            state.keywords.forEach((keyword, index) => {
                const tag = document.createElement('div');
                tag.className = 'keyword-tag';
                tag.textContent = keyword;
                tag.onclick = () => removeKeyword(index);
                tag.title = 'ã‚¯ãƒªãƒƒã‚¯ã§å‰Šé™¤';
                container.appendChild(tag);
            });
            
            // Show/hide hint about deleting tags
            const hint = document.getElementById('keywordHint');
            if (hint) {
                if (state.keywords.length > 0) {
                    hint.textContent = 'ğŸ’¡ ã‚¿ã‚°ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å‰Šé™¤ã§ãã¾ã™';
                    hint.style.display = 'block';
                } else {
                    hint.style.display = 'none';
                }
            }
        }

        function handleKeywordEnter(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                addKeywordFromInput();
            }
        }
        
        function addKeywordFromButton() {
            addKeywordFromInput();
        }
        
        function addKeywordFromInput() {
            const input = document.getElementById('keywordInput');
            const value = input.value.trim();
            if (value && !state.keywords.includes(value)) {
                state.keywords.push(value);
                input.value = '';
                renderStep2();
                saveState();
            }
        }

        function removeKeyword(index) {
            state.keywords.splice(index, 1);
            renderStep2();
            saveState();
        }
        
        function populateStep1Reference() {
            const container = document.getElementById('step1ReferenceList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Combine all STEP 1 items into a single numbered list
            const allItems = [
                ...state.iwakan.filter(i => i && i.trim()),
                ...state.yorokobi.filter(i => i && i.trim()),
                ...state.ikari.filter(i => i && i.trim())
            ];
            
            if (allItems.length === 0) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--ink-light); font-style: italic;">STEP 1ã®å†…å®¹ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            allItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'reference-item';
                div.innerHTML = `
                    <div class="reference-number">${index + 1}</div>
                    <div class="reference-text">${item.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                `;
                container.appendChild(div);
            });
        }
        
        function toggleReference() {
            const content = document.getElementById('step1Reference');
            const icon = document.getElementById('referenceToggleIcon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        // STEP 3: Grouping (Keyword-based)
        function renderStep3() {
            // Populate STEP 1 episodes reference
            populateStep1Reference();
            const refList = document.getElementById('step3ReferenceList');
            if (refList) {
                refList.innerHTML = document.getElementById('step1ReferenceList').innerHTML;
            }
            
            // Generate keyword-based groups
            generateKeywordGroups();
        }

        function generateKeywordGroups() {
            const container = document.getElementById('keywordGroupsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (state.keywords.length === 0) {
                container.innerHTML = '<p style="padding: 2rem; text-align: center; color: var(--ink-light); font-style: italic;">STEP 2ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>';
                return;
            }
            
            const colors = ['#D97642', '#7A9B76', '#C9A961', '#8B7A99', '#6B8E9B'];
            
            // Ensure groups array matches keywords
            while (state.groups.length < state.keywords.length) {
                state.groups.push({ 
                    name: '', 
                    items: [], 
                    color: colors[state.groups.length % colors.length] 
                });
            }
            
            // Remove excess groups if keywords were deleted
            if (state.groups.length > state.keywords.length) {
                state.groups = state.groups.slice(0, state.keywords.length);
            }
            
            // Update group names from keywords
            state.keywords.forEach((keyword, index) => {
                if (state.groups[index]) {
                    state.groups[index].name = keyword;
                    state.groups[index].color = colors[index % colors.length];
                }
            });
            
            // Render groups
            state.keywords.forEach((keyword, index) => {
                const group = state.groups[index];
                const div = document.createElement('div');
                div.className = 'group';
                div.style.marginBottom = '1.5rem';
                div.innerHTML = `
                    <div class="group-header" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <div class="group-color" style="width: 20px; height: 20px; border-radius: 50%; background: ${group.color}; flex-shrink: 0;"></div>
                        <div class="group-name" style="font-family: var(--font-sans); font-weight: 600; font-size: 1.1rem; color: var(--ink);">${keyword}</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç•ªå·ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                        <input type="text" 
                               class="text-input" 
                               value="${group.items.join(', ')}" 
                               placeholder="ä¾‹: 1, 3, 5"
                               style="min-height: 50px;"
                               oninput="updateGroupItems(${index}, this.value)">
                        <p style="font-size: 0.85rem; color: var(--ink-light); font-style: italic; margin-top: 0.5rem;">
                            ğŸ’¡ å·¦ã®ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä¸€è¦§ã®ç•ªå·ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„
                        </p>
                    </div>
                `;
                container.appendChild(div);
            });
            
            saveState();
        }

        function updateGroupItems(index, value) {
            const items = value.split(',').map(i => i.trim()).filter(i => i);
            if (state.groups[index]) {
                state.groups[index].items = items;
                saveState();
            }
        }

        function toggleReferenceStep3() {
            const content = document.getElementById('step3Reference');
            const icon = document.getElementById('referenceToggleIconStep3');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        // STEP 4: Theme Discovery
        function renderStep4() {
            // Populate STEP 3 groups reference
            populateStep3GroupsReference();
            
            // Load text inputs
            document.getElementById('theme').value = state.theme;
            document.getElementById('values').value = state.values;
            document.getElementById('unacceptable').value = state.unacceptable;
            document.getElementById('idealWorld').value = state.idealWorld;

            // Add listeners
            ['theme', 'values', 'unacceptable', 'idealWorld'].forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.dataset.listenerAdded) {
                    el.addEventListener('input', (e) => {
                        state[id] = e.target.value;
                        saveState();
                    });
                    el.dataset.listenerAdded = 'true';
                }
            });
        }

        function populateStep3GroupsReference() {
            const container = document.getElementById('step4ReferenceList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (state.groups.length === 0 || state.keywords.length === 0) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--ink-light); font-style: italic;">STEP 3ã®ã‚°ãƒ«ãƒ¼ãƒ—ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            // å…¨ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’å–å¾—ï¼ˆé•å’Œæ„Ÿâ†’å–œã³â†’æ€’ã‚Šã®é †ï¼‰
            const allEpisodes = [
                ...state.iwakan.filter(i => i && i.trim()),
                ...state.yorokobi.filter(i => i && i.trim()),
                ...state.ikari.filter(i => i && i.trim())
            ];
            
            const colors = ['#D97642', '#7A9B76', '#C9A961', '#8B7A99', '#6B8E9B'];
            
            state.groups.forEach((group, index) => {
                const div = document.createElement('div');
                div.className = 'reference-item';
                div.style.marginBottom = '1.5rem';
                div.style.background = 'rgba(217, 118, 66, 0.03)';
                div.style.padding = '1rem';
                div.style.borderRadius = '8px';
                
                // ã‚°ãƒ«ãƒ¼ãƒ—åã¨ã‚«ãƒ©ãƒ¼ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
                let html = `
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 2px solid ${colors[index % colors.length]};">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: ${colors[index % colors.length]}; flex-shrink: 0;"></div>
                        <strong style="font-family: var(--font-sans); font-size: 1.05rem;">${group.name}</strong>
                    </div>
                `;
                
                // ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç•ªå·ãŒã‚ã‚‹å ´åˆã€å†…å®¹ã‚’è¡¨ç¤º
                if (group.items && group.items.length > 0) {
                    html += '<div style="display: flex; flex-direction: column; gap: 0.5rem;">';
                    
                    group.items.forEach(itemNum => {
                        const num = parseInt(itemNum);
                        if (!isNaN(num) && num > 0 && num <= allEpisodes.length) {
                            const episodeText = allEpisodes[num - 1];
                            html += `
                                <div style="display: flex; gap: 0.5rem; padding: 0.5rem; background: white; border-radius: 4px;">
                                    <span style="font-weight: 600; color: ${colors[index % colors.length]}; min-width: 24px;">${num}.</span>
                                    <span style="color: var(--ink-light); font-size: 0.9rem; line-height: 1.5;">${episodeText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>
                                </div>
                            `;
                        }
                    });
                    
                    html += '</div>';
                } else {
                    html += '<div style="color: var(--ink-light); font-style: italic; font-size: 0.9rem;">ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                }
                
                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function toggleReferenceStep4() {
            const content = document.getElementById('step4Reference');
            const icon = document.getElementById('referenceToggleIconStep4');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        // STEP 5: Question Creation
        function renderStep5() {
            // Populate STEP 4 themes reference
            populateStep4ThemesReference();

            // Render questions list
            renderQuestionsList();
        }

        function populateStep4ThemesReference() {
            const container = document.getElementById('step5ReferenceList');
            if (!container) return;
            
            container.innerHTML = '';
            
            const themes = [
                { label: 'ç¹°ã‚Šè¿”ã—å‡ºã¦ãã‚‹ãƒ†ãƒ¼ãƒ', value: state.theme },
                { label: 'ã‚ãªãŸãŒå¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³', value: state.values },
                { label: 'ã‚ãªãŸãŒã€Œè¨±ã›ãªã„ã€ã‚‚ã®', value: state.unacceptable },
                { label: 'ã‚ãªãŸãŒã€Œã“ã†ã‚ã£ã¦ã»ã—ã„ã€ä¸–ç•Œ', value: state.idealWorld }
            ];
            
            const hasContent = themes.some(t => t.value && t.value.trim());
            
            if (!hasContent) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--ink-light); font-style: italic;">STEP 4ã®å†…å®¹ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            themes.forEach(theme => {
                if (theme.value && theme.value.trim()) {
                    const div = document.createElement('div');
                    div.className = 'reference-item';
                    div.innerHTML = `
                        <strong style="font-family: var(--font-sans); display: block; margin-bottom: 0.5rem;">${theme.label}</strong>
                        <div style="color: var(--ink-light);">${theme.value.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                    `;
                    container.appendChild(div);
                }
            });
        }

        function toggleReferenceStep5() {
            const content = document.getElementById('step5Reference');
            const icon = document.getElementById('referenceToggleIconStep5');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        function renderQuestionsList() {
            const container = document.getElementById('questionsList');
            if (!container) return;
            
            container.innerHTML = '';
            state.questions.forEach((question, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-number">å•ã„${index + 1}</div>
                    <input type="text" 
                           class="text-input" 
                           value="${question}" 
                           placeholder="ã‚ãªãŸã®å•ã„ã‚’æ›¸ã„ã¦ãã ã•ã„..."
                           oninput="updateQuestion(${index}, this.value)"
                           style="min-height: 60px;">
                `;
                container.appendChild(div);
            });
        }

        function updateQuestion(index, value) {
            state.questions[index] = value;
            saveState();
        }

        function addQuestion() {
            if (state.questions.length < 5) {
                state.questions.push('');
                renderQuestionsList();
                saveState();
            }
        }

        // STEP 6: Question Creation
        function renderStep6() {
            // Populate STEP 5 whys and questions reference
            populateStep5WhysAndQuestionsReference();

            // Load final section
            document.getElementById('finalQuestion').value = state.finalQuestion;
            document.getElementById('whyThisQuestion').value = state.whyThisQuestion;

            // Add listeners
            ['finalQuestion', 'whyThisQuestion'].forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.dataset.listenerAdded) {
                    el.addEventListener('input', (e) => {
                        state[id] = e.target.value;
                        saveState();
                    });
                    el.dataset.listenerAdded = 'true';
                }
            });
        }

        function populateStep5WhysAndQuestionsReference() {
            const container = document.getElementById('step6ReferenceList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // STEP 4 themes (å„é …ç›®ã‚’å€‹åˆ¥ã®ãƒ–ãƒ­ãƒƒã‚¯ã«)
            const themes = [
                { label: 'ç¹°ã‚Šè¿”ã—å‡ºã¦ãã‚‹ãƒ†ãƒ¼ãƒ', value: state.theme },
                { label: 'ã‚ãªãŸãŒå¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³', value: state.values },
                { label: 'ã‚ãªãŸãŒã€Œè¨±ã›ãªã„ã€ã‚‚ã®', value: state.unacceptable },
                { label: 'ã‚ãªãŸãŒã€Œã“ã†ã‚ã£ã¦ã»ã—ã„ã€ä¸–ç•Œ', value: state.idealWorld }
            ];
            
            const hasThemes = themes.some(t => t.value && t.value.trim());
            
            if (hasThemes) {
                const div = document.createElement('div');
                div.className = 'reference-item';
                div.style.marginBottom = '1.5rem';
                
                let html = '<strong style="font-family: var(--font-sans); display: block; margin-bottom: 1rem; font-size: 1.05rem;">STEP 4ã§è¦‹ã¤ã‘ãŸã“ã¨</strong>';
                html += '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
                
                themes.forEach(theme => {
                    if (theme.value && theme.value.trim()) {
                        html += `
                            <div style="padding: 1rem; background: rgba(122, 155, 118, 0.08); border-radius: 6px; border-left: 3px solid var(--accent-sage);">
                                <div style="font-weight: 600; font-size: 0.9rem; color: var(--ink); margin-bottom: 0.5rem;">${theme.label}</div>
                                <div style="color: var(--ink-light); font-size: 0.9rem; line-height: 1.6;">${theme.value.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
                div.innerHTML = html;
                container.appendChild(div);
            }
            
            // Questions (æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒ)
            const questionsWithContent = state.questions.filter(q => q && q.trim());
            if (questionsWithContent.length > 0) {
                const div = document.createElement('div');
                div.className = 'reference-item';
                div.innerHTML = `
                    <strong style="font-family: var(--font-sans); display: block; margin-bottom: 0.75rem;">STEP 5ã§ä½œã£ãŸå•ã„ã®åŸå‹</strong>
                    ${questionsWithContent.map((q, i) => `
                        <div style="margin-bottom: 0.5rem; padding: 0.75rem; background: rgba(217, 118, 66, 0.05); border-radius: 8px; color: var(--ink);">
                            <span style="font-weight: 600; font-family: var(--font-sans);">å•ã„${i + 1}:</span> ${q.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                        </div>
                    `).join('')}
                `;
                container.appendChild(div);
            }
            
            if (container.innerHTML === '') {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--ink-light); font-style: italic;">STEP 4ãƒ»5ã®å†…å®¹ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
            }
        }

        function toggleReferenceStep6() {
            const content = document.getElementById('step6Reference');
            const icon = document.getElementById('referenceToggleIconStep6');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        // Completion
        function completeWorkbook() {
            const question = state.finalQuestion.trim() || 'ã‚ãªãŸã®å•ã„ã¯ã€ã“ã“ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™';
            const isComplete = state.finalQuestion.trim().length > 0;

            document.getElementById('displayQuestion').textContent = question;
            
            // Add a visual indicator if incomplete
            const questionElement = document.getElementById('displayQuestion');
            const messageElement = document.getElementById('completionMessage');
            
            if (!isComplete) {
                questionElement.style.fontStyle = 'italic';
                questionElement.style.color = 'var(--ink-light)';
                messageElement.innerHTML = 'ä½“é¨“ç‰ˆã‚’æœ€å¾Œã¾ã§è¦‹ã¦ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚<br>æ™‚é–“ã‚’ã‹ã‘ã¦ã€ã˜ã£ãã‚Šè‡ªåˆ†ã¨å‘ãåˆã†ã¨ã€ã‚ãªãŸã ã‘ã®å•ã„ãŒå¿…ãšè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚';
            } else {
                questionElement.style.fontStyle = 'normal';
                questionElement.style.color = 'var(--ink)';
                messageElement.innerHTML = '6ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’é€šã˜ã¦ã€ã‚ãªãŸã¯ã€Œè‡ªåˆ†ã®å•ã„ã€ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚<br>ã“ã®å•ã„ãŒã€ã‚ãªãŸã®äº‹æ¥­ã®åŸç‚¹ã«ãªã‚Šã¾ã™ã€‚';
            }
            
            goToStep(7);
        }

        function downloadResults() {
            // Create a beautiful results page in a new window
            const resultsWindow = window.open('', '_blank');
            
            if (!resultsWindow) {
                alert('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // Generate comprehensive results HTML
            const resultsHTML = generateResultsHTML();
            
            resultsWindow.document.write(resultsHTML);
            resultsWindow.document.close();
            
            // Auto-trigger print dialog after a short delay
            resultsWindow.addEventListener('load', () => {
                setTimeout(() => {
                    resultsWindow.print();
                }, 500);
            });
        }
        
        function generateResultsHTML() {
            const now = new Date().toLocaleString('ja-JP');
            
            return `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯çµæœ - ${now}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #FAF7F0;
            --ink: #2C2416;
            --ink-light: #5C5346;
            --accent-warm: #D97642;
            --accent-sage: #7A9B76;
            --accent-gold: #C9A961;
            --border: #E5DFD3;
        }
        
        @page {
            margin: 2.5cm;
            size: A4;
        }
        
        @media print {
            @page {
                margin: 2cm;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--cream);
            color: var(--ink);
            font-family: 'Crimson Pro', 'Noto Serif JP', serif;
            line-height: 1.7;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border);
            page-break-after: avoid;
        }
        
        .logo {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--ink-light);
            margin-bottom: 0.75rem;
            font-weight: 500;
        }
        
        h1 {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--ink);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }
        
        .subtitle {
            font-size: 0.9rem;
            color: var(--ink-light);
            font-style: italic;
            margin-bottom: 0.5rem;
        }
        
        .date {
            font-size: 0.85rem;
            color: var(--ink-light);
        }
        
        .question-box {
            background: linear-gradient(135deg, rgba(217, 118, 66, 0.08) 0%, rgba(122, 155, 118, 0.08) 100%);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            page-break-inside: avoid;
        }
        
        .question-label {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--accent-warm);
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--ink);
            line-height: 1.4;
            margin-bottom: 1rem;
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
        }
        
        .question-text.empty {
            font-style: italic;
            color: var(--ink-light);
            font-size: 1.25rem;
        }
        
        .confidence {
            font-size: 0.95rem;
            color: var(--ink-light);
            font-style: italic;
        }
        
        .day-section {
            margin: 3rem 0;
            page-break-inside: avoid;
        }
        
        h2 {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--ink);
            margin: 2.5rem 0 1.25rem 0;
            padding-top: 1.75rem;
            border-top: 1px solid var(--border);
            page-break-after: avoid;
        }
        
        h2:first-of-type {
            margin-top: 1.5rem;
        }
        
        h3 {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-warm);
            margin: 1.25rem 0 0.75rem 0;
            page-break-after: avoid;
        }
        
        .subsection {
            margin: 1.5rem 0;
            page-break-inside: avoid;
        }
        
        .item-list {
            margin: 0.5rem 0 1rem 0;
        }
        
        .item {
            margin: 0.4rem 0;
            padding-left: 1.25rem;
            position: relative;
            font-size: 0.95rem;
        }
        
        .item::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: var(--accent-warm);
            font-weight: bold;
        }
        
        .empty-message {
            color: var(--ink-light);
            font-style: italic;
            padding: 0.75rem;
            font-size: 0.9rem;
        }
        
        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin: 0.5rem 0;
        }
        
        .keyword {
            background: white;
            border: 1px solid var(--border);
            padding: 0.25rem 0.65rem;
            border-radius: 50px;
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-size: 0.85rem;
            color: var(--ink);
        }
        
        .group {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.9rem;
            margin: 0.5rem 0;
        }
        
        .group-name {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }
        
        .group-items {
            color: var(--ink-light);
            font-size: 0.85rem;
        }
        
        .pattern-item {
            margin: 0.9rem 0;
        }
        
        .pattern-label {
            font-family: 'DM Sans', 'Noto Sans JP', sans-serif;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }
        
        .pattern-value {
            color: var(--ink-light);
            padding-left: 1rem;
            font-size: 0.95rem;
        }
        
        .footer {
            margin-top: 2.5rem;
            padding-top: 1.75rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--ink-light);
            font-size: 0.85rem;
            page-break-inside: avoid;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .question-box {
                background: rgba(217, 118, 66, 0.05);
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .keyword {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .group {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Hide browser URL and other print artifacts */
            @page {
                margin: 2cm;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Why Me? Workbook</div>
        <h1>ã‚ãªãŸã®å¥½ãã¨ä¸–ç•Œã®æ¬²ã—ã„ã‚’<br>çµã³ã¤ã‘ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯</h1>
        <div class="subtitle">ä½“é¨“ç‰ˆ çµæœãƒ¬ãƒãƒ¼ãƒˆ</div>
        <div class="date">å®Œäº†æ—¥æ™‚ï¼š${now}</div>
    </div>
    
    <div class="question-box">
        <div class="question-label">ã‚ãªãŸã®å•ã„</div>
        <div class="question-text ${!state.finalQuestion || !state.finalQuestion.trim() ? 'empty' : ''}">${
            state.finalQuestion && state.finalQuestion.trim() 
                ? state.finalQuestion 
                : 'ã‚ãªãŸã®å•ã„ã¯ã€ã“ã“ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™'
        }</div>
    </div>
    
    <div class="day-section">
        <h2>STEP 1ï¼šäººç”Ÿã®ç—•è·¡</h2>
        
        <div class="subsection">
            <h3>é•å’Œæ„Ÿ</h3>
            ${state.iwakan && state.iwakan.filter(i => i && i.trim()).length > 0 ? `
                <div class="item-list">
                    ${state.iwakan.filter(i => i && i.trim()).map(i => 
                        `<div class="item">${escapeHtml(i)}</div>`
                    ).join('')}
                </div>
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
        
        <div class="subsection">
            <h3>å–œã³ã®æºæ³‰</h3>
            ${state.yorokobi && state.yorokobi.filter(i => i && i.trim()).length > 0 ? `
                <div class="item-list">
                    ${state.yorokobi.filter(i => i && i.trim()).map(i => 
                        `<div class="item">${escapeHtml(i)}</div>`
                    ).join('')}
                </div>
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
        
        <div class="subsection">
            <h3>æ€’ã‚Šã®æºæ³‰</h3>
            ${state.ikari && state.ikari.filter(i => i && i.trim()).length > 0 ? `
                <div class="item-list">
                    ${state.ikari.filter(i => i && i.trim()).map(i => 
                        `<div class="item">${escapeHtml(i)}</div>`
                    ).join('')}
                </div>
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
    </div>
    
    <div class="day-section">
        <h2>STEP 2ï¼šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º</h2>
        
        <div class="subsection">
            <h3>æŠ½å‡ºã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</h3>
            ${state.keywords && state.keywords.length > 0 ? `
                <div class="keywords">
                    ${state.keywords.map(k => 
                        `<span class="keyword">${escapeHtml(k)}</span>`
                    ).join('')}
                </div>
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
    </div>
    
    <div class="day-section">
        <h2>STEP 3ï¼šã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°</h2>
        
        <div class="subsection">
            <h3>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—</h3>
            ${state.groups && state.groups.some(g => g.name || (g.items && g.items.length > 0)) ? 
                state.groups.map(g => `
                    <div class="group">
                        <div class="group-name">${escapeHtml(g.name) || 'ï¼ˆæœªå‘½åï¼‰'}</div>
                        <div class="group-items">ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç•ªå·ï¼š${
                            g.items && g.items.length > 0 
                                ? escapeHtml(g.items.join(', ')) 
                                : 'ãªã—'
                        }</div>
                    </div>
                `).join('') 
            : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
    </div>
    
    <div class="day-section">
        <h2>STEP 4ï¼šãƒ†ãƒ¼ãƒç™ºè¦‹</h2>
        
        <div class="subsection">
            <h3>æ·±å±¤ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
            ${state.theme || state.values || state.unacceptable || state.idealWorld ? `
                ${state.theme ? `
                    <div class="pattern-item">
                        <div class="pattern-label">ç¹°ã‚Šè¿”ã—å‡ºã¦ãã‚‹ãƒ†ãƒ¼ãƒ</div>
                        <div class="pattern-value">${escapeHtml(state.theme)}</div>
                    </div>
                ` : ''}
                ${state.values ? `
                    <div class="pattern-item">
                        <div class="pattern-label">å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³</div>
                        <div class="pattern-value">${escapeHtml(state.values)}</div>
                    </div>
                ` : ''}
                ${state.unacceptable ? `
                    <div class="pattern-item">
                        <div class="pattern-label">è¨±ã›ãªã„ã‚‚ã®</div>
                        <div class="pattern-value">${escapeHtml(state.unacceptable)}</div>
                    </div>
                ` : ''}
                ${state.idealWorld ? `
                    <div class="pattern-item">
                        <div class="pattern-label">ã“ã†ã‚ã£ã¦ã»ã—ã„ä¸–ç•Œ</div>
                        <div class="pattern-value">${escapeHtml(state.idealWorld)}</div>
                    </div>
                ` : ''}
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
    </div>
    
    <div class="day-section">
        <h2>STEP 5ï¼šå•ã„ã®åŸå‹</h2>
        
        <div class="subsection">
            <h3>ä½œæˆã—ãŸå•ã„ã®åŸå‹</h3>
            ${state.questions && state.questions.filter(q => q && q.trim()).length > 0 ? `
                <div class="item-list">
                    ${state.questions.filter(q => q && q.trim()).map(q => 
                        `<div class="item">${escapeHtml(q)}</div>`
                    ).join('')}
                </div>
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
    </div>
    
    <div class="day-section">
        <h2>STEP 6ï¼šå•ã„ã®å‰µé€ </h2>
        
        <div class="subsection">
            <h3>é¸ã‚“ã å•ã„ã«ã¤ã„ã¦</h3>
            ${state.whyThisQuestion && state.whyThisQuestion.trim() ? `
                <div class="pattern-item">
                    <div class="pattern-label">ãªãœã“ã®å•ã„ã‚’é¸ã‚“ã ã‹</div>
                    <div class="pattern-value">${escapeHtml(state.whyThisQuestion)}</div>
                </div>
            ` : '<div class="empty-message">ï¼ˆæœªå…¥åŠ›ï¼‰</div>'}
        </div>
    </div>
    
    <div class="footer">
        <p style="font-weight: 600; margin-bottom: 1rem;">NEXT STEP</p>
        <p>ã“ã®ä½“é¨“ç‰ˆã§ã¯ã€æœ¬ç·¨ã®Phase 1ã€è‡ªåˆ†ã®æºæ³‰ã‚’æ¢ã‚‹ã€‘ã‚’ä½“é¨“ã—ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚</p>
        <p style="margin-top: 0.75rem;">æœ¬ç·¨ã®ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã§ã¯ã€æ¬¡ã«ã“ã®"å•ã„"ã‚’å…±æœ‰ã§ãã‚‹ä»–è€…ã®å­˜åœ¨ã‚’æƒ³åƒã—ã¾ã™ã€‚<br>
        ã•ã‚‰ã«ãã®"å…±é€šã®å•ã„"ã‚’ã‚‚ã¨ã«ã€ä»®èª¬ã€è§£æ±ºã™ã¹ãèª²é¡Œã€‘ã‚’ã€æƒ³å®šã—ã¾ã™ã€‚<br>
        ã€è§£æ±ºã™ã¹ãèª²é¡Œã€‘ãŒæ±ºã¾ã£ãŸã‚‰æœ¬æ ¼çš„ã«ä»–è€…ã¸ã®ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚</p>
        <p style="margin-top: 0.75rem;">ã“ã®ã‚ˆã†ã«"è‡ªåˆ†ã®æ„è¦‹"ã¨"ç¾å®Ÿã®ä»–è€…"ã‚’è¡Œãæ¥ã—ãªãŒã‚‰ã€1ã‹æœˆé–“ã§ã€ã‚ãªãŸã ã‘ã®äº‹æ¥­ã‚¢ã‚¤ãƒ‡ã‚¢ã€‘ã‚’ç”Ÿã¿å‡ºã™ã“ã¨ãŒã€ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã®ç›®çš„ã§ã™ã€‚</p>
    </div>
</body>
</html>`;
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function resetWorkbook() {
            // Clear localStorage
            localStorage.clear();
            
            // Clear ALL input fields on the page
            document.querySelectorAll('input[type="text"], textarea').forEach(field => {
                field.value = '';
            });
            
            // Reset state completely
            state = {
                currentStep: 0,
                iwakan: [''],
                yorokobi: [''],
                ikari: [''],
                keywords: [],
                groups: [],
                theme: '',
                values: '',
                unacceptable: '',
                idealWorld: '',
                questions: [''],
                finalQuestion: '',
                whyThisQuestion: ''
            };
            
            // Hide app, show landing
            document.getElementById('app').classList.remove('active');
            document.getElementById('landing').style.display = 'flex';
            
            // Hide all days
            document.querySelectorAll('.day').forEach(d => d.classList.add('hidden'));
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        function confirmReset() {
            // Show custom modal instead of native confirm
            document.getElementById('confirmModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        function confirmResetAction() {
            closeModal();
            resetWorkbook();
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
